<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta charset="utf-8">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="The blog/playground for personal amusement">
		<meta name="keywords" content="hugo, blog, terran-x, playground, github">
   		<meta name="author" content="Sheva Xu">

		<title>Fun with maps, part I</title>

		
		
		
		
		<link href="http://shevaxu.github.io/css/bootstrap.min.css" rel="stylesheet">
		
		
		<link href="//vjs.zencdn.net/4.11/video-js.css" rel="stylesheet">
		
		
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
		
		
		
		
		<link href="http://shevaxu.github.io/css/github.css" rel="stylesheet"> 
		
		
		
		<link href="http://shevaxu.github.io/css/clean-blog.min.css" rel="stylesheet">	
		
		<link href="http://shevaxu.github.io/css/terran.css" rel="stylesheet">
		
		
		<link href="http://shevaxu.github.io/img/favicon.png" rel="icon">
	</head>

	<body>
		
		<div class="fixed-img-bg" style="background: url('http://shevaxu.github.io/img/bg.jpg'); background-size: cover;"></div>
		

		
		

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
	<div class="container-fluid">
		
		<div class="navbar-header page-scroll">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">Terran-X</a>
		</div>

		
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>					
					<a href="http://shevaxu.github.io"><i class="fa fa-home"></i>Home</a>
				</li>
				<li>
					<a href="http://shevaxu.github.io/post/"><i class="fa fa-file-text"></i>Posts</a>
				</li>
				<li>
					<a href="#"><i class="fa fa-futbol-o"></i>Playground</a>
				</li>
				<li>
					<a href="#"><i class="fa fa-paper-plane"></i>Tools</a>
				</li>
			</ul>
		</div>
		
	</div>
	
</nav>


<header class="intro-header" 
	 style="background-image: url('http://shevaxu.github.io/img/post-bg.jpg')" >
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<div class="post-heading">
					<h1>Fun with maps, part I</h1> 
					
					<h2 class="subheading">Basic introduction to D3.js and OSM</h2> 
					
					<span class="meta">
						Jan 17, 2015  (Jan 28, 2015) 						 
						
						&nbsp; &nbsp; 
						<i class="fa fa-sitemap"></i>
						
						 <a class="label" href="http://shevaxu.github.io/categories/Development">Development</a>  <a class="label" href="http://shevaxu.github.io/categories/Apps">Apps</a> 
						
						
						&nbsp; &nbsp; 
						<i class="fa fa-tags"></i>
						
						 <a class="label" href="http://shevaxu.github.io/tags/Maps">Maps</a>  <a class="label" href="http://shevaxu.github.io/tags/Visualization">Visualization</a>  <a class="label" href="http://shevaxu.github.io/tags/D3.js">D3.js</a>  <a class="label" href="http://shevaxu.github.io/tags/OSM">OSM</a> 
						
					</span>
					
				</div>
			</div>
		</div>
	</div>
</header>

<article>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				

<p>I like travel.</p>

<p>I always wanted an app to help me memorize all the extradinary experiences in every journey. There are plenty of travalling apps on the web but none of them match my imagination so far (yeah, I&rsquo;m that picky). So why not develop one myself?</p>

<blockquote>
<p>It is good to have an end to journey toward; but it is the journey that matters, in the end.</p>

<p>&ndash; Ernest Hemingway</p>
</blockquote>

<h2 id="toc_0">D3.js &amp; My Footprint Map</h2>

<p>The first thing I tried was <a href="http://d3js.org/"><em>D3.js</em></a>, which is for <em>Data-driven documents</em>. Its capability is far beyond making a map, and I have just explored the very little part of it. Mastering such a comprehensive tool would require so much effort, and I&rsquo;m glad that I began learning it with a certain project idea in mind that offered extra motivation. The map I was going to make is my footprint of provinces in China.</p>

<p>The idea came from an image I saw on <a href="http://couchsurfing.org/"><em>Couchsurfing</em></a> for someone&rsquo;s visited countires (like <a href="http://traveltip.org/countries_visited.php">this</a>). I have not explored many countries yet so I wanted to make one for visited provinces in China. I found <a href="http://blog.econst.org/2014/06/02/china-map-with-d3-js-and-geojson/">one with similar idea</a> but it possesses no interaction I desire (but it gave me inspiration and data).</p>

<p>My final map/app came out like this:</p>

<p><a href="../../playground/footprint-map.html" target="_blank">
<img src="../../img/posts/my-footprint.png" width=100%>
</a></p>

<ol>
<li>It visualizes both the provinces and cities borders;</li>
<li>you can pick your marking color for each provinces independently (according to your own logic);</li>
<li>you can save it to .png image.</li>
</ol>

<p>You can try making your own footprint map (by clicking the image or go to the <em>Playgournd</em>) and share it. Below are the key steps/obstacles during my development that would help in case you want to customize your own map for another country or the world.</p>

<h3 id="toc_1">The magic of D3.js</h3>

<p>The data model confused me until I found the story of <a href="http://bost.ocks.org/mike/circles/"><em>Three Little Circle</em></a> by Mike Bostock, one of the author of D3.js. He also wrote a detail post about <a href="http://bost.ocks.org/mike/selection/"><em>How Selections Work</em></a> that I plan to take time reading/understanding in the future.</p>

<h3 id="toc_2">Data &amp; TopoJSON</h3>

<p>The provinces/cities data I got was originally in <a href="http://geojson.org/"><em>GeoJSON</em></a> format, a subset of <a href="http://www.json.org/"><em>JavaScript Object Notation</em></a> for geographic data. I converted it to <a href="https://github.com/mbostock/topojson/wiki"><em>TopoJSON</em></a> using <a href="http://geojson.io/"><em>geojson.io</em></a> (it&rsquo;s actually a great online map data editor), mainly for smaller file size and faster rendering (but it requires additional <em>topojson.js</em> and GeoJSON is more widely supported).</p>

<p><em>P.S.</em> This project also help me pick up some geographic knowledge, e.g., the different map <a href="http://techslides.com/demos/d3/d3-continents-projections.html">projections</a> (and <em>Mercator</em> is the one I use).</p>

<h3 id="toc_3">Colors &amp; JSColor</h3>

<p>I give each province a &ldquo;checked&rdquo; attribute that filling the path with default color when off and filling with the color I choose when on. <a href="http://jscolor.com/"><em>JSColor</em></a> is so handy as a color picker. After all, each color can be represented as a string like <em>&rdquo;#fff&rdquo;</em> or <em>&rdquo;#D2E4B4&rdquo;</em>.</p>

<h3 id="toc_4">Images &amp; SaveSvgAsPng</h3>

<p>It took me few days to figure out how to save the rendered svg (that&rsquo;s what D3.js draws for geo-paths) to image, which is important for a closure since I don&rsquo;t want to <em>screenshot my work</em>. Mike also wrote a post about <a href="http://bl.ocks.org/biovisualize/8187844">direct conversion on Chrome</a> but I found <a href="https://github.com/exupero/saveSvgAsPng">saveSvgAsPng</a> more easy to use (and at least supports Safari as well). There&rsquo;s a <a href="http://spin.atomicobject.com/2014/01/21/convert-svg-to-png/">blog post</a> explains how it works (the key is to convert it to a data URL and go get it).</p>

<h2 id="toc_5">More About Maps</h2>

<p>D3.js is good at illustrating many kinds of data and statistics, but it&rsquo;s not designed for maps. Frankly speaking, what it does is just visualizing the a bunch of shapes (and treat them as paths), which is a simple form of the <a href="http://en.wikipedia.org/wiki/Vector_map"><em>vector map</em></a>. But that&rsquo;s not the map you used to see.</p>

<p>Actually, <a href="http://en.wikipedia.org/wiki/Tiled_web_map"><em>tiled map</em></a> is the most popular way to display and navigate maps so far. To be more specific, it is the <em>raster tiled web map</em>, which delivers rendered images (usually PNGs) of adjacent tiles from a server to your browser that seamlessly joins them. You might already seen the tiled effect loading a map when the network is slow.</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/0/03/Tiled_web_map_Stevage.png/800px-Tiled_web_map_Stevage.png" alt="" />
</p>

<p>(Image from Wikipedia)</p>

<p>Another emerging method for dilivering styled web maps is <a href="http://en.wikipedia.org/wiki/Vector_tiles"><em>vector tiles</em></a> (a.k.a. vectiles), which is more of a hybrid of vector map and tiled map. It reduces data transfer greatly by making the client do the rastering.</p>

<p>During these days&rsquo; study of web maps, I&rsquo;d like to view it as two major components: the data/service and the client. As a case of the vector map, the <em>footprint map</em> uses TopoJSON as data (local service) and D3.js as client. For tiled map, <em>Google Maps</em> has provided both data/service and client (API). Buth there are other players in the game, and I will introduce them shortly.</p>

<h3 id="toc_6">Misc</h3>

<ul>
<li><a href="http://www.mapshaper.org/">mapshaper</a>: <em>line simplification</em> tool of vector map for smaller file size and easier zooming, see this <a href="http://bost.ocks.org/mike/simplify/">article</a> for explanation;</li>
<li>For other kinds of web maps, read the <a href="http://en.wikipedia.org/wiki/Web_mapping"><em>wiki page</em></a></li>
<li>From <a href="http://www.naturalearthdata.com/"><em>Natural Earth</em></a> you can acquire &ldquo;free vector and raster map data at 1:10m, 1:50m, and 1:110m scales
&ldquo;.</li>
</ul>

<h2 id="toc_7">OpenStreetMap - The Data</h2>

<p><a href="https://www.openstreetmap.org"><em>OpenStreetMap (OSM)</em></a> might be the strongest competitor of Google Maps. The main difference is that the map data is collected by the people on the ground, like a Wikipedia of map, which means you can &ldquo;take back control of your map&rdquo;. That&rsquo;s why it&rsquo;s &ldquo;rich and detailed&rdquo;, and always up-to-date (the <a href="http://planet.openstreetmap.org/">whole data</a> updates every week for, and it&rsquo;s now over 40GB of it).
If you are still not convinced by those pros, <a href="http://switch2osm.org/"><em>Switch2OSM</em></a> will explain to you &ldquo;from first principles to technical how-tos&rdquo;.</p>

<p>But how those tiled web maps work? First let&rsquo;s see those conventions they follow:</p>

<ul>
<li>Tiles are 256x256 PNG images;</li>
<li>The outer most zoom level 0 convers the entire world under <em>Mercator</em> projection;</li>
<li>A single tile is replaced by 4 tiles when zooming in;</li>
<li>The Z-X-Y scheme is used for accessing tiles through REST API.</li>
</ul>

<p>To give an example, here&rsquo;s the <em>first</em> tile of OSM - <code>http://tile.osm.org/0/0/0.png</code>:</p>

<p><a href="../../playground/osm-tiles.html" target="_blank">
<img src="../../img/posts/000.png">
</a></p>

<p>Cool, it&rsquo;s the whole world (well, actually not all of it as the latitude is limited to around 85 degrees). I have made a simple map client using the OSM data in the <em>Playground</em> (click the image also directs you there). This toy provides blunt interactions for navigating to any place you want theoritically, up to the max-allowed zoom level (don&rsquo;t try keeping zoom in, as I have not tested the max yet and it will crash :P).</p>

<p>But if you want to build real apps upon it, keep in mind that the data and the service (or server) is not the same in this case, since OSM focus on letting people contribute the data and sharing them (that&rsquo;s already great enough for a non-profit group, see the <a href="http://wiki.openstreetmap.org/wiki/Tile_usage_policy"><em>usage policy</em></a> for more details).</p>

<p>Luckily, we don&rsquo;t have to worry about serving the data since there are other groups just do it, some are combined with the client. So, next!</p>

<p>Waiting for part II :)</p>

			</div>
		</div>
		
	</div>
</article>






<footer>
	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
				<ul class="list-inline text-center">
					
					<li>
						<a target="_blank" href=https://github.com/ShevaXu>
							<span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
						</a>
					</li>
					  
					<li>
						<div class="copyright text-muted">Powered by
							<a target="_blank" href="http://gohugo.io">
								<img src="http://shevaxu.github.io/img/hugo44.ico" />
							</a>
						</div>
					</li>
				</ul>
				<p class="copyright text-muted">Copyright &copy; Sheva Xu 2014-2015</p>
			</div>
		</div>
	</div>
</footer>

	
	
	<a class="back-to-top">
		<i class="fa fa-chevron-circle-up fa-5x fa-square"></i>
	</a>
	
	
	<script src="http://shevaxu.github.io/js/jquery-2.1.3.min.js"></script>	
	
	<script src="http://shevaxu.github.io/js/bootstrap.min.js"></script>
	
	<script src="http://shevaxu.github.io/js/clean-blog.min.js"></script>
	
	
	<script src="http://shevaxu.github.io/js/highlight.pack.js"></script>
	<script>
		hljs.initHighlightingOnLoad();
	</script>
	
	
	<script>
		$(document).ready(function() {
			var offset = 220;
			var duration = 500;
			$(window).scroll(function() {
				if ($(this).scrollTop() > offset) {
					$(".back-to-top").fadeIn(duration);
				} else {
					$(".back-to-top").fadeOut(duration);
				}
			});
		
			$(".back-to-top").click(function(event) {
				event.preventDefault();
				$("html, body").animate({scrollTop: 0}, duration);
				return false;
			})
		});
	</script>

</body>

</html>
